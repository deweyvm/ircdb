#!/usr/bin/env python
import subprocess
import datetime
import time
import cgitb
cgitb.enable()
t = time.clock()
env = {'MYSQL_UNIX_PORT':'/var/run/mysqld/mysqld.sock'}
p = subprocess.Popen(["./ircdb \"MySql ODBC 5.1 Driver\" testdb -g"],
                     stdout=subprocess.PIPE,
                     env=env,
                     shell=True)

(out, err) = p.communicate()
if len(err) > 0:
    print(err)
    sys.exit(1)
print("Content-type: text/html\n")
print(out)
duration = time.clock() - t
print('<div id="footer">Generated by ircdb on %s in %.4f seconds.</div>' % (datetime.datetime.now(), duration))
